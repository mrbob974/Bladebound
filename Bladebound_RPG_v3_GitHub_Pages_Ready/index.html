
<!DOCTYPE html>
<html>
<head>
  <title>Bladebound RPG v3</title>
  <style>
    canvas { background: #111; display: block; margin: 0 auto; }
    #ui { text-align: center; color: white; font-family: monospace; margin-top: 10px; }
    button { margin: 0 10px; }
  </style>
</head>
<body>
<div id="ui">
  <p>Select your class:</p>
  <button onclick="selectClass('archer')">Archer</button>
  <button onclick="selectClass('mage')">Mage</button>
  <button onclick="selectClass('miner')">Miner</button>
  <button onclick="selectClass('soldier')">Soldier</button>
  <p id="status"></p>
</div>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let player = null;
let enemies = [];
let sprites = {};
let lastAttack = 0;
const attackInterval = 800;

const enemyTypes = ["orc", "troll", "necromancer"];

function selectClass(type) {
  player = {
    x: 400, y: 300, size: 32, type: type, hp: 100, speed: 2,
    sprite: sprites[type], attack: 10, range: type === "archer" || type === "mage" ? 120 : 40
  };
  document.getElementById("status").innerText = "Class selected: " + type;
  spawnEnemies();
}

function spawnEnemies() {
  for (let i = 0; i < 5; i++) {
    let kind = enemyTypes[Math.floor(Math.random() * enemyTypes.length)];
    enemies.push({
      x: Math.random() * 700 + 50,
      y: Math.random() * 500 + 50,
      hp: 50 + Math.random() * 50,
      type: kind,
      sprite: sprites[kind],
      size: 32
    });
  }
}

function loadSprites(callback) {
  const names = ["archer", "mage", "miner", "soldier", "orc", "troll", "necromancer"];
  let loaded = 0;
  names.forEach(name => {
    const img = new Image();
    img.src = `assets/sprites/${name}.png`;
    img.onload = () => {
      sprites[name] = img;
      loaded++;
      if (loaded === names.length) callback();
    };
  });
}

function distance(a, b) {
  return Math.sqrt((a.x - b.x)**2 + (a.y - b.y)**2);
}

function update() {
  if (!player) return;
  enemies.forEach(e => {
    let dx = player.x - e.x;
    let dy = player.y - e.y;
    let dist = Math.sqrt(dx*dx + dy*dy);
    if (dist > 1) {
      e.x += dx / dist * 0.3;
      e.y += dy / dist * 0.3;
    }
  });

  let now = Date.now();
  if (now - lastAttack > attackInterval) {
    enemies.forEach(e => {
      if (distance(player, e) <= player.range) {
        e.hp -= player.attack;
        if (player.type === "mage") {
          // AOE nearby others
          enemies.forEach(other => {
            if (other !== e && distance(other, e) < 40) {
              other.hp -= player.attack / 2;
            }
          });
        }
      }
    });
    lastAttack = now;
  }

  enemies = enemies.filter(e => e.hp > 0);
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  if (player) ctx.drawImage(player.sprite, player.x, player.y, player.size, player.size);
  enemies.forEach(e => {
    ctx.drawImage(e.sprite, e.x, e.y, e.size, e.size);
  });
}

function gameLoop() {
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

loadSprites(() => {
  document.getElementById("status").innerText = "Choose your class to begin!";
  gameLoop();
});
</script>
</body>
</html>
